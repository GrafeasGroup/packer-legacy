---

- name: "Create administrative user '{{ username }}'"
  user:
    name: '{{ username }}'
    password: '{{ password_hash }}'
    comment: administrative user
    shell: /bin/bash
    append: true
    groups:
      - sudo
  become: true

- name: "Create '~/.ssh' directory for '{{ username }}'"
  file:
    state: directory
    path: '/home/{{ username }}/.ssh'
    owner: '{{ username }}'
    group: '{{ username }}'
    mode: 0700
  become: true

- name: "Assign public key to login as '{{ username }}'"
  lineinfile:
    line: '{{ public_key }}'
    path: '/home/{{ username }}/.ssh/authorized_keys'
    owner: '{{ username }}'
    group: '{{ username }}'
    mode: 0600

# vim: ft=yaml.ansible
